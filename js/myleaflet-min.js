!function () { var e = L.GridLayer.prototype._initTile; L.GridLayer.include({ _initTile: function (t) { e.call(this, t); var o = this.getTileSize(); t.style.width = o.x + 1 + "px", t.style.height = o.y + 1 + "px" } }) }(), $(document).ready((function () { $("input[type=text]").val(""), $(".alert").hide(), $("#search-value").on("keydown", (function (e) { 13 == e.keyCode && (e.preventDefault(), searchWFS()) })) })); var wfsPolylayer, qLayer = null, queryBox = null, wfsSelangor = new L.featureGroup, newGroup = new L.featureGroup, url_geoserver = "https://nas-st.dyndns.org/geoserver/sghg4583/wms?", url_geoserver_wfs = "https://nas-st.dyndns.org/geoserver/sghg4583/ows?", url_geoserver_utm = "https://www.geoinfo.utm.my/geoserver/pbt.pengerang/wms?", wmsSelangor = new L.tileLayer.wms(url_geoserver, { layers: "sghg4583:selangor_postgis", format: "image/png8", transparent: !0, tiled: !0, opacity: .6, zIndex: 100, attribution: "Datos desde Geoserver" }), wmsJohor = new L.tileLayer.wms(url_geoserver_utm, { layers: "pbt.pengerang:mukim", format: "image/png8", transparent: !0, tiled: !0, opacity: 1, zIndex: 100, attribution: "Datos desde Geoserver UTM" }), wfsURL = url_geoserver_wfs + "service=wfs&version=1.1.0&request=GetFeature&typeNames=sghg4583:selangor_postgis&outputFormat=application/json", geojsonWFSstyle = { fillColor: "#8ea8c3", fillOpacity: .4, color: "#23395b", weight: 1, opacity: .6 }; async function getWFSgeojson() { try { const e = await fetch(wfsURL); return await e.json() } catch (e) { } } function countryFilter(e) { if ("MYS" == e.id) return !0 } getWFSgeojson().then((e => { wfsPolylayer = L.geoJSON([e], { onEachFeature: function (e, t) { t.on({ mouseover: highlightFeature, mouseout: resetHighlight }); var o = "<div><b>" + e.properties.parlimen + "</b></div>" + e.properties.dun + "</div>"; t.bindPopup(o, { maxWidth: "500px", className: "customPop" }) }, style: geojsonWFSstyle }).addTo(wfsSelangor), map.fitBounds(wfsPolylayer.getBounds()) })); var geojsonLayer2, url = "https://nas-st.dyndns.org/countries.geo.json"; $.getJSON(url, (function (e) { new L.geoJSON(e, { filter: countryFilter, style: function (e) { return { weight: 0, fillColor: "yellow", fillOpacity: .3 } } }).addTo(newGroup) })), $.getJSON(url, (function (e) { geojsonLayer2 = new L.geoJSON(e, { style: function (e) { return { weight: 2, color: "red", fillOpacity: 0 } } }), controlLayers.addOverlay(geojsonLayer2, "Límites de países (GeoJSON)") })); var mAttr = "", osmUrl = "https://{s}.tile.osm.org/{z}/{x}/{y}.png", osm = L.tileLayer(osmUrl, { attribution: mAttr }), cartodbUrl = "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png", cartodb = L.tileLayer(cartodbUrl, { attribution: mAttr }), mapbox = L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}", { attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>', maxZoom: 18, id: "mapbox/streets-v11", tileSize: 512, zoomOffset: -1, accessToken: "pk.eyJ1IjoibWF0dTI5ODIiLCJhIjoiY2ozbnE4aHU2MDAyajJ3bGdwMDV3N2M0cSJ9.t7at_aruzOdsPgL43MrxpQ" }), map = L.map("map", { center: [3.197288, 101.57718], zoom: 9, minZoom: 3, layers: [wfsSelangor, mapbox] }), centerBounds = map.getBounds().getCenter(), baseLayers = { Mapbox: mapbox, OpenStreetMap: osm }, overlayMaps = { "Selangor (WMS)": wmsSelangor, "Selangor (WFS)": wfsSelangor, "Johor UTM (WMS)": wmsJohor, "Malaysia (GeoJSON)": newGroup }, controlLayers = L.control.layers(baseLayers, overlayMaps, { collapsed: !1 }).addTo(map); L.control.scale({ metric: !0, imperial: !1, maxWidth: 100 }).addTo(map), map.on("overlayadd", (function (e) { wfsSelangor.bringToBack(), newGroup.bringToBack(), geojsonLayer2.bringToBack() })), $(".default-view").on("click", (function () { map.fitBounds(wfsSelangor.getBounds()) })), map.on("mousemove", (function (e) { $(".map-coordinate").html("Lat: " + e.latlng.lat + "<br />Lon: " + e.latlng.lng) })); var info = L.control(); function highlightFeature(e) { var t = e.target; t.setStyle({ weight: 3, color: "#666", dashArray: 1, fillOpacity: .7, fillColor: "#c7e9c0" }), L.Browser.ie || L.Browser.opera || t.bringToFront(), info.update(t.feature.properties) } function resetHighlight(e) { wfsPolylayer.resetStyle(e.target), info.update() } function clearResult() { return document.getElementById("search-value").value = "", document.getElementById("wfsResult").innerHTML = "", null != qLayer && map.removeLayer(qLayer), map.setView(centerBounds, 9), !1 } function searchWFS() { if (null != qLayer && map.removeLayer(qLayer), !(queryBox = document.getElementById("search-value").value)) return $("#alert_empty").fadeTo(2e3, 500).slideUp(500, (function () { $(".alert").slideUp(500) })), !1; const e = encodeURI("&cql_filter=strToLowerCase(strStripAccents(dun)) ILIKE '%" + queryBox + "%'"); var t = url_geoserver_wfs + "service=wfs&version=1.1.0&request=GetFeature&typeNames=sghg4583:selangor_postgis&outputFormat=application/json" + e, o = { fillColor: "#ff7800", fillOpacity: .4, color: "red", weight: 2, opacity: 1 }; (async function () { try { const e = await fetch(t); return await e.json() } catch (e) { } })().then((e => { e.totalFeatures > 0 ? (document.getElementById("wfsResult").innerHTML = e.totalFeatures + " resultado(s) encontrados.", qLayer = L.geoJSON([e], { onEachFeature: function (e, t) { var o = "<div><b>" + e.properties.parlimen + "</b></div>" + e.properties.dun + "</div>"; t.bindPopup(o) }, style: o }).addTo(map), map.fitBounds(qLayer.getBounds())) : (document.getElementById("wfsResult").innerHTML = "", $("#alert_noResult").fadeTo(2e3, 500).slideUp(500, (function () { $(".alert").slideUp(500) }))) })) } info.update = function (e) { searchResults.innerHTML = e ? "<p class=''><b class='boundaryName'>" + e.parlimen + "</b><br />" + e.dun + "</div></p>" : "" };